{"version":3,"file":"OEPartialView.js","sourceRoot":"","sources":["../../../../../Volumes/Data/OElite/cosmos/public/OEme/tmp/broccoli_type_script_compiler-input_base_path-7nMsUUjz.tmp/0/src/app/core/framework/ui/view/OEPartialView.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n    Component,\n    ViewContainerRef,\n    ComponentResolver,\n    ComponentMetadata,\n    ComponentFactory,\n    ReflectiveInjector,\n    ViewEncapsulation,\n    OnChanges,\n    Input,\n    ViewChild\n} from \"@angular/core\";\nimport {OELayoutConfig} from \"../../layout/OELayoutConfig\";\n\n/**\n * Created by mleader1 on 29/06/2016.\n */\n\nexport function createComponentFactory(resolver:ComponentResolver, metadata:ComponentMetadata):Promise<ComponentFactory<any>> {\n    const cmpClass = class OEmePartialView {\n    };\n    const decoratedCmp = Component(metadata)(cmpClass);\n    return resolver.resolveComponent(decoratedCmp);\n}\n\n@Component({\n    selector: \"oe-partial-view\",\n    encapsulation: ViewEncapsulation.None,\n    template: \"<div #target></div>\"\n})\n\nexport class OEPartialView implements OnChanges {\n    @Input()\n    public layoutConfig:OELayoutConfig;\n    @ViewChild('target', {read: ViewContainerRef}) viewContainerRef:ViewContainerRef;\n\n    constructor(private resolver:ComponentResolver) {\n        this.layoutConfig = null;\n    }\n\n    ngOnChanges() {\n\n        if (!this.layoutConfig) return;\n\n\n        const metaData = new ComponentMetadata({\n            selector: 'view',\n            template: this.parseViewSelectorToTags(this.layoutConfig.viewSelector),\n            encapsulation: ViewEncapsulation.None,\n            directives: this.layoutConfig.viewDirectives,\n            providers: this.layoutConfig.viewProviders\n        });\n\n        createComponentFactory(this.resolver, metaData)\n            .then(factory=> {\n                const injector = ReflectiveInjector.fromResolvedProviders([], this.viewContainerRef.parentInjector);\n                this.viewContainerRef.createComponent(factory, 0, injector, []);\n            });\n    }\n\n\n    /**\n     * parsing view selector into a valid secondary selector for dynamically generated view\n     * TODO: should be improved, it' lack of full functionality\n     * @param viewSelector\n     */\n    parseViewSelectorToTags(viewSelector:string):string {\n        var result = \"\";\n        var tag = \"\";\n        var classes = \"\";\n        var attributes = \"\";\n        if (viewSelector.startsWith('.')) {\n            tag = \"div\";\n            classes = viewSelector.replace('.', ' ');\n            var squareBracketIndex = classes.indexOf('[')\n            if (squareBracketIndex > 0) {\n                classes = classes.substr(0, squareBracketIndex);\n            }\n        }\n        else if (viewSelector.startsWith('[')) {\n            tag = \"div\";\n            attributes = viewSelector.substring(1, viewSelector.indexOf(']') - 2);\n        }\n        else {\n            var dotIndex = viewSelector.indexOf('.');\n            var bracketIndex = viewSelector.indexOf('[');\n            if (dotIndex > 0) {\n                tag = viewSelector.substring(0, dotIndex);\n                classes = viewSelector.substring(dotIndex + 1);\n            }\n            else if (bracketIndex > 0) {\n                tag = viewSelector.substring(0, bracketIndex);\n                attributes = viewSelector.substring(bracketIndex + 1).replace(']', '').replace('\"', \"'\").trim().replace(\"'\", \"\").replace('\"', '');\n                ;\n                if (attributes.startsWith('class')) {\n                    var attrsToClasses = attributes.substring(5).trim().substring(1);\n                    attributes = \"\";\n                    classes = (classes + ' ' + attrsToClasses).trim();\n                }\n            }\n            else {\n                tag = viewSelector;\n            }\n        }\n        tag = (tag || \"div\").replace('.', '').replace('[', '').replace(']', '').replace('\"', \"\\'\").replace(\"'\", \"\\'\");\n        classes = (classes || \"\").replace('.', '').replace('[', '').replace(']', '').replace('\"', \"\\'\").replace(\"'\", \"\\'\");\n        attributes = (attributes || \"\").replace('.', '').replace('[', '').replace(']', '').replace('\"', \"\\'\").replace(\"'\", \"\\'\");\n\n        result = `<${tag} class=\"${classes.trim().length > 0 ? classes : ''}\" ${attributes} ><ng-content></ng-content></${tag}>`.trim();\n        if (tag.trim() != 'unnamed view')\n            return result;\n        else\n            return '';\n    }\n\n}"]}